var setUpGMaps=function(){var a=document.createElement("script");a.type="text/javascript",a.src="https://maps.google.com/maps/api/js?v=3&libraries=geometry&key="+config.gmaps.key+"&callback=initializeMap",document.body.appendChild(a)},initializeMap=function(){var a=new google.maps.LatLng(43.3,-101.79),b={scrollwheel:!1,navigationControl:!0,mapTypeControl:!0,scaleControl:!0,draggable:!0,zoom:3,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map"),b)},initGMaps=function(){var a={zoom:11,center:new google.maps.LatLng(myLat,myLong),styles:[{featureType:"all",elementType:"geometry.fill",stylers:[{weight:"2.00"}]},{featureType:"all",elementType:"geometry.stroke",stylers:[{color:"#9c9c9c"}]},{featureType:"all",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#eeeeee"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#7b7b7b"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#46bcec"},{visibility:"on"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#c8d7d4"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#070707"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]}]},b=document.getElementById("map"),c=new google.maps.Map(b,a);new google.maps.Marker({position:new google.maps.LatLng(myLat,myLong),map:c,title:"My Location!"})},myMarker,countryTags=[],regionTags=[],cityTags=[],zipCodeTags=[],ISPTags=[],ASnumTags=[],submitterTags=[],zipCodeSubmitterTags=[],destHostNameTags=[],ipAddressTags=[],hostNameTags=[],trIdTags=[],privacyRepUrl=url_base+"/transparency.php",ixMapsDataJson={},ixMapsData={},allowMultipleTrs=!1,allowRecenter=!0,showHops=!0,showHopsNum=!1,showRouters=!0,showNsa=!1,showHotel=!1,showGoogle=!1,showUc=!1,showIXca=!1,showCiraIPT=!1,showAtt=!1,showVerizon=!1,showGooglePublicPeer=!1,showGoogleTO=!1,addMarkerInOrigin=!1,markersInOrigin=[],showDynamicLegend=!0,showMapInfoGlobal=!1,excludeCoord0=!0,excludeCoordGen=!0,excludeImpDist=!1,excludeReservedAS=!0,excludeUserFlagged=!0,impDistLog="",skippedRouterNum=new Array(0,0,0,0),trRouterCount=0,trRouterAdded=0,trRenderSpeed=50,trRenderStop=!1,m_lat=null,m_lng=null,mouse_in_polyline=!0,map=null,activeTrId=null,activeTrObj=null,trCollection=[],trOcollection=[],trsAddedToMap=[],ipCollection=new Object,cHotelData,gmObjects=[],infowindow=null,infowindowRoute=null,infowindowTimeout,gmNsa=[],gmHotel=[],gmGoogle=[],gmUc=[],gmIXca=[],gmCiraIPT=[],gmAtt=[],gmVerizon=[],gmGooglePublicPeer=[],gmGoogleTO=[],totTRs=0,activeCarriers=new Object,coordCollected=[],coordCollectedObj=[],addMarkerInLastHop=!0,addMarkerInDesination=!0,privacyData,addCollectedCoord=function(a,b){var c=new google.maps.LatLng(a,b);if(coordCollected.push(c),renderCollectedCoords(),2==coordCollected.length){var d=coordCollected[0],e=coordCollected[1],f=google.maps.geometry.spherical.computeDistanceBetween(d,e);f/=1e3,console.log("gmDist: ",f)}else if(coordCollected.length>2){for(m in coordCollectedObj)coordCollectedObj[m].setMap(null);coordCollected.length=0,coordCollectedObj.length=0}},renderCollectedCoords=function(){jQuery.each(coordCollected,function(a,b){var c=new google.maps.Polyline({path:coordCollected,strokeOpacity:1,strokeColor:"#FF0000",strokeWeight:5});coordCollectedObj.push(c),c.setMap(map)})},setShowHops=function(){showHops?(showHops=!1,jQuery("#map-show-hops").removeClass("map-tool-on").addClass("map-tool-off")):(showHops=!0,jQuery("#map-show-hops").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowHops",showHops)},setShowHopsNum=function(){showHopsNum?(showHopsNum=!1,jQuery("#map-show-hops-num").removeClass("map-tool-on").addClass("map-tool-off")):(showHopsNum=!0,jQuery("#map-show-hops-num").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowHopsNum",showHops)},setAllowRecenter=function(){allowRecenter?(allowRecenter=!1,jQuery("#map-allow-recenter").removeClass("map-tool-on").addClass("map-tool-off")):(allowRecenter=!0,jQuery("#map-allow-recenter").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setAllowRecenter",allowRecenter)},setShowRouters=function(){showRouters?(showRouters=!1,jQuery("#map-show-routers").removeClass("map-tool-on").addClass("map-tool-off")):(showRouters=!0,jQuery("#map-show-routers").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowRouters",showRouters)},setShowNsa=function(){showNsa?(showNsa=!1,removeGeoMarkers(1),jQuery("#map-show-nsa").removeClass("map-tool-on").addClass("map-tool-off")):(showNsa=!0,renderGeoMarkers(1),jQuery("#map-show-nsa").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowNsa",showNsa)},setShowHotel=function(){showHotel?(showHotel=!1,removeGeoMarkers(2),jQuery("#map-show-hotel").removeClass("map-tool-on").addClass("map-tool-off")):(showHotel=!0,renderGeoMarkers(2),jQuery("#map-show-hotel").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowHotel",showHotel)},setShowGoogle=function(){showGoogle?(showGoogle=!1,removeGeoMarkers(3),jQuery("#map-show-google").removeClass("map-tool-on").addClass("map-tool-off")):(showGoogle=!0,renderGeoMarkers(3),jQuery("#map-show-google").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowGoogle",showGoogle)},setShowUc=function(){showUc?(showUc=!1,removeGeoMarkers(4),jQuery("#map-show-uc").removeClass("map-tool-on").addClass("map-tool-off")):(showUc=!0,renderGeoMarkers(4),jQuery("#map-show-uc").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowUc",showUc)},setShowIXca=function(){showIXca?(showIXca=!1,removeGeoMarkers(5),jQuery("#map-show-IXca").removeClass("map-tool-on").addClass("map-tool-off")):(showIXca=!0,renderGeoMarkers(5),jQuery("#map-show-IXca").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowIXca",showIXca)},setShowCiraIPT=function(){showCiraIPT?(showCiraIPT=!1,removeGeoMarkers(6),jQuery("#map-show-CiraIPT").removeClass("map-tool-on").addClass("map-tool-off")):(showCiraIPT=!0,renderGeoMarkers(6),jQuery("#map-show-CiraIPT").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowCiraIPT",showCiraIPT)},setShowAtt=function(){showAtt?(showAtt=!1,removeGeoMarkers(7),jQuery("#map-show-Att").removeClass("map-tool-on").addClass("map-tool-off")):(showAtt=!0,renderGeoMarkers(7),jQuery("#map-show-Att").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowAtt",showAtt)},setShowVerizon=function(){showVerizon?(showVerizon=!1,removeGeoMarkers(8),jQuery("#map-show-Verizon").removeClass("map-tool-on").addClass("map-tool-off")):(showVerizon=!0,renderGeoMarkers(8),jQuery("#map-show-Verizon").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowVerizon",showVerizon)},setShowGoogleTo=function(){showGoogleTO?(showGoogleTO=!1,removeGeoMarkers(9),jQuery("#map-show-google-to").removeClass("map-tool-on").addClass("map-tool-off")):(showGoogleTO=!0,renderGeoMarkers(9),jQuery("#map-show-google-to").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowGoogleTo",showGoogleTO)},setDefaultMapSettings=function(){allowMultipleTrs=!1,jQuery("#map-allow-multiple").removeClass("map-tool-on").addClass("map-tool-off"),addMarkerInOrigin=!0,jQuery("#map-show-marker-origin").removeClass("map-tool-off").addClass("map-tool-on"),excludeReservedAS=!1,jQuery("#map-exclude-d").removeClass("map-tool-on").addClass("map-tool-off")},setAddMarkerInOrigin=function(){addMarkerInOrigin?(addMarkerInOrigin=!1,jQuery("#map-show-marker-origin").removeClass("map-tool-on").addClass("map-tool-off")):(addMarkerInOrigin=!0,jQuery("#map-show-marker-origin").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setAddMarkerInOrigin",addMarkerInOrigin)},setAllowMultipleTrs=function(){allowMultipleTrs?(allowMultipleTrs=!1,jQuery("#map-allow-multiple").removeClass("map-tool-on").addClass("map-tool-off"),jQuery("#map-action-remove-all-but-this").hide()):(allowMultipleTrs=!0,jQuery("#map-allow-multiple").removeClass("map-tool-off").addClass("map-tool-on"),jQuery("#map-action-remove-all-but-this").show()),console.log("setAllowMultipleTrs",allowMultipleTrs)},excludeA=function(){excludeCoord0?(excludeCoord0=!1,jQuery("#map-exclude-a").removeClass("map-tool-on").addClass("map-tool-off")):(excludeCoord0=!0,jQuery("#map-exclude-a").removeClass("map-tool-off").addClass("map-tool-on")),console.log("exclude coords 0",excludeCoord0)},excludeB=function(){excludeCoordGen?(excludeCoordGen=!1,jQuery("#map-exclude-b").removeClass("map-tool-on").addClass("map-tool-off")):(excludeCoordGen=!0,jQuery("#map-exclude-b").removeClass("map-tool-off").addClass("map-tool-on")),console.log("exclude generic coords.",excludeCoordGen)},excludeC=function(){excludeImpDist?(excludeImpDist=!1,jQuery("#map-exclude-c").removeClass("map-tool-on").addClass("map-tool-off")):(excludeImpDist=!0,jQuery("#map-exclude-c").removeClass("map-tool-off").addClass("map-tool-on")),console.log("exclude impossible distance.",excludeImpDist),alert("Note that this option is functional but it has not been fully tested.")},excludeD=function(){excludeReservedAS?(excludeReservedAS=!1,jQuery("#map-exclude-d").removeClass("map-tool-on").addClass("map-tool-off")):(excludeReservedAS=!0,jQuery("#map-exclude-d").removeClass("map-tool-off").addClass("map-tool-on")),console.log("exclude Reserved AS.",excludeReservedAS)},excludeE=function(){excludeUserFlagged?(excludeUserFlagged=!1,jQuery("#map-exclude-e").removeClass("map-tool-on").addClass("map-tool-off")):(excludeUserFlagged=!0,jQuery("#map-exclude-e").removeClass("map-tool-off").addClass("map-tool-on")),console.log("exclude User Flagged routers.",excludeUserFlagged)},loadMapData=function(){setTimeout(function(){initializeMap(),showThisTr(_.last(_.keys(ixMapsDataJson))),setTableSorters(),renderLayers(),console.log("IXmaps geographic data downloaded! [TRs: "+totTRs+"]")},300),removeAllTrs(),jQuery("#options-btn").removeClass("hidden"),jQuery("#layers-btn").removeClass("hidden"),jQuery("#help-btn").removeClass("hidden")},setTableSorters=function(){console.log("Sorting TR Tables"),jQuery("#traceroutes-table").tablesorter({sortList:[[2,1]]})},showTotalTrInfo=function(){var a=trCollection.length;if(showDynamicLegend){var b="";b+='<table id="carrier-table" style="width: 100%;" class="tablesorter tr-list-result ui tablesorter selectable celled compact table">',b+="<thead><tr>",b+='<th title="Telecommunications service provider, i.e. a local internet service provider, or longhaul ‘backbone carrier.’ Click on highlighted carriers to see more about them.">Carrier</th>',b+='<th class="nat-header">Nat.</th>',b+='<th class="routers-header" title="Number of routers mapped belonging to the carrier.">Rts.</th>',b+='<th class="score-header" title="Number of stars for data privacy transparency awarded to the carrier in the latest privacy transparency report. See Transparency page.">Transparency</th>',b+="</tr></thead><tbody>",jQuery.each(activeCarriers,function(a,c){var d=privacyData.scores[a],e=-1,f="",g="",h="";void 0===d?g="":(e=getPrivacyScore(a),f="",f=renderPrivacyScore(e)),b+='<tr class="carrier" title="Click on the carrier name to show more details about its rating on each 10 criteria star criteria">',h=e>=0?'<a class="link" href="javascript:viewPrivacy('+a+')">'+c[1]+"</a>":"<span>"+c[1]+"</span>";var i=getAsnColour(a).replace(/rgb/i,"rgba").replace(/\)/i,",0.7)");if(b+='<td><div class="carrier-colour" style="background-color: '+i+'"></div>'+h+"</td>",null!=j){var j=c[2].toLowerCase();b+='<td class=""><i class="'+j+' flag"></i>'+c[2]+"</td>"}else b+='<td class=""></td>';b+='<td class="centered-table-cell">'+c[0]+"</td>",b+='<td class="star-col">'+f+"</td>",b+="</tr>"}),b+="</tbody></table>",jQuery("#carriers-results-table").html(b),0!=a&&jQuery("#carrier-table").tablesorter({sortList:[[2,1]]})}jQuery("#tr-count").text(trsAddedToMap.length)},showThisTr=function(a){allowMultipleTrs||removeAllTrs(),renderTr(a),showTotalTrInfo()},stopRender=function(){trRenderStop?(jQuery("#map-render-stop-play").val("Stop"),trRenderStop=!1):(jQuery("#map-render-stop-play").val("Play"),trRenderStop=!0),console.log("stopRender",trRenderStop)},checkIfStopped=function(){return console.log("... Checking trRenderStop"),trRenderStop},addAllTrs=function(){removeAllTrs(),jQuery("#map-status-info").show();var a=1,b=trRenderSpeed;jQuery.each(ixMapsDataJson,function(c,d){checkIfStopped();setTimeout(function(){return!trRenderStop&&(renderTr2(c),showThisTr(c),jQuery("#tr-count").text(a),a++,void 0)},b),b+=trRenderSpeed}),removeTr(),showTotalTrInfo()},removeAllTrs=function(){for(removeTr(),trsAddedToMap=[],skippedRouterNum=new Array(0,0,0,0),trRouterAdded=0,impDistLog="",ipCollection=new Object,jQuery("#map-impossible-distance-log").html(""),jQuery("#map-router-exclusion").html(""),jQuery("#map-loading-status").html(""),jQuery("#map-tr-active").html("");markersInOrigin[0];)markersInOrigin.pop().setMap(null);for(;trCollection[0];)trCollection.pop().setMap(null);for(;trOcollection[0];)trOcollection.pop().setMap(null);activeCarriers=new Object,showTotalTrInfo(),jQuery("#tr-count").text("0")},removeTr=function(){null!=activeTrObj&&activeTrObj.setMap(null)},excludeRouter=function(a,b,c,d){var e=!1;return excludeCoord0&&0==a.lat&&0==a.long&&(e=!0,1==d&&(skippedRouterNum[0]+=1)),excludeCoordGen&&(60==a.lat&&a.long==-95||38==a.lat&&a.long==-97||37.751==a.lat&&a.long==-97.822)&&(e=!0,1==d&&(skippedRouterNum[1]+=1)),excludeImpDist&&1==a.impDist&&1!=c&&(e=!0,1==d&&(skippedRouterNum[2]+=1)),excludeReservedAS&&a.asNum==-1&&null==a.glOverride&&(e=!0,1==d&&(skippedRouterNum[3]+=1)),excludeUserFlagged&&1==a.flagged&&(e=!0,1==d&&(skippedRouterNum[4]+=1)),jQuery("#map-impossible-distance-log").html(impDistLog),e},renderTr=function(a){var b,a=a.toString(),c=null,d=[],e=[],f=!1,g=!1,h="",i="";if(allowMultipleTrs||(skippedRouterNum=new Array(0,0,0,0,0),trRouterCount=0,trRouterAdded=0),trsAddedToMap.indexOf(a)!=-1?(g=!0,console.log("The TR ("+a+") is already in the map")):trsAddedToMap.push(a),!g){if(jQuery.each(ixMapsDataJson[a],function(c,e){if(0==trRouterCount&&(b=new Array(e.lat,e.long)),f=excludeRouter(e,a,c,1),!f){var g=new Array(a,c,e.lat,e.long,e.asNum,e.asName,e.ip,e.gl_override,e.mmCity,e.mmCountry,e.hostname);if(e.asNum in activeCarriers)activeCarriers[e.asNum][0]+=1;else{var h=e.asName;h.length>15&&(h=h.slice(0,15)+"..."),activeCarriers[e.asNum]=Array(1,h,e.mm_country)}d.push(g),trRouterAdded++}trRouterCount++}),1==d.length){console.log("TR with one hop Id:",d[0][0]);var j=new google.maps.LatLng(d[0][2],d[0][3]);e.push(j)}if(jQuery.each(d,function(b,f){if(addMarkerInOrigin&&0==b){console.log("addMarkerInOrigin");var g=new google.maps.LatLng(d[0][2],d[0][3]),h=new google.maps.Marker({position:g,map:map,title:"Origin: TRid: "+d[0][0]}),i=url_base+"/_assets/img/grn-blank.png";h.setIcon(i),h.setMap(map),markersInOrigin.push(h)}if(showRouters){var j=getAsnColour([d[b][4]]),k=new google.maps.LatLng(d[b][2],d[b][3]),l=new google.maps.Marker({position:k,map:map,icon:{path:google.maps.SymbolPath.CIRCLE,fillOpacity:.6,fillColor:j,strokeWeight:0,scale:10}}),m=d[b][6];m in ipCollection?ipCollection[m]+=1:ipCollection[m]=1,google.maps.event.addListener(l,"click",function(){viewTrDetails(d[b][0])}),google.maps.event.addListener(l,"mouseover",function(){infowindowTimeout=setTimeout(function(){infowindow&&infowindow.close();var c=createMarkerText(a,d,b);infowindow=new google.maps.InfoWindow({content:c}),infowindow.open(map,l)},300)}),google.maps.event.addListener(l,"mouseout",function(){clearTimeout(infowindowTimeout)}),l.setMap(map),trOcollection.push(l)}if(showHops&&b>0){var n=[],o=new google.maps.LatLng(d[b-1][2],d[b-1][3]),p=new google.maps.LatLng(d[b][2],d[b][3]);n.push(o),n.push(p),e.push(o),e.push(p);var q=getAsnColour([d[b-1][4]]);c=null,c=new google.maps.Polyline({path:n,strokeColor:q,strokeOpacity:.6,strokeWeight:6}),google.maps.event.addListener(c,"click",function(){viewTrDetails(a)}),google.maps.event.addListener(c,"mouseover",function(){trHopMouseover(d[b-1][0],d[b-1][1],1)}),c.setMap(map),trCollection.push(c)}}),allowRecenter&&0!=e.length)if(1==e.length)map.setCenter(e[0]),map.setZoom(4);else{for(var k=new google.maps.LatLngBounds,l=0;l<e.length;l++)k.extend(e[l]);e.length=0,map.fitBounds(k)}}i+=g?h:"TR added",removeTr()},createMarkerText=function(a,b,c){infowindowRoute=b;var d=b[c],e=getPrivacyScore(d[4]),f="";e>0&&(f="<div>"+renderPrivacyScore(e)+"</div>");var g="",h="";c>0&&(g='<button style="font-weight: bold;" onclick="openPreviousRouterMarker('+a+", "+c+')"> < </button>'),c+1<b.length&&(h='<button style="font-weight: bold;" onclick="openNextRouterMarker('+a+", "+c+')"> > </button>');var i='<div class="router-infowindow"><div>'+g+'<span style="font-weight: bold;"> Router '+d[1]+" </span>"+h+'<button id="flag-it-btn" data-asn="'+d[0]+'" data-hop="'+d[1]+'" data-ip="'+d[6]+'" onclick="flagActiveRouter()"><span id="flag-btn-text">Flag router</span><img id="flag-btn-img" src="/_assets/img/icon-flag.png"/></button></div><div style="margin-top: 8px; font-weight: bold;">'+d[10]+'</div><div style="font-weight: bold"><span>'+d[8]+", "+d[9]+'</span><span style="float: right;">'+d[2]+", "+d[3]+'</span></div><div style="margin-bottom: 20px"><span>'+d[5]+'</span><span style="float: right;">'+f+'</span></div><div><a href="javascript:removeAllButThis('+a+');">Remove All but This Route</a></div><div><a href="javascript:viewTrDetails('+d[0]+');">View Details of This Route (Id '+d[0]+")</a></div></div>";return i},openNextRouterMarker=function(a,b){infowindow&&infowindow.close();var c=createMarkerText(a,infowindowRoute,b+1);infowindow=new google.maps.InfoWindow({content:c}),infowindow.open(map,trOcollection[b+1])},openPreviousRouterMarker=function(a,b){infowindow&&infowindow.close();var c=createMarkerText(a,infowindowRoute,b-1);infowindow=new google.maps.InfoWindow({content:c}),infowindow.open(map,trOcollection[b-1])},flagActiveRouter=function(){jQuery(".flagging.modal").modal("show");var a=jQuery("#flag-it-btn").data();showFlags(a.asn,a.hop,a.ip,!0)},setTRidActive=function(a){jQuery("#tr-a-"+a).toggleClass("tr-ids-active")},renderTr2=function(a){var b,c=[];jQuery.each(ixMapsDataJson[a],function(d,e){if(b=excludeRouter(e,a,d,0),!b){var f=new google.maps.LatLng(e.lat,e.long);c.push(f)}}),null!=activeTrObj&&activeTrObj.setMap(null);var d=trCollection.length+1;activeTrObj=null;var e={path:"M 0,-0.5 0,0.5",strokeWeight:4,strokeOpacity:1,scale:3};activeTrObj=new google.maps.Polyline({path:c,strokeOpacity:0,strokeWeight:13,icons:[{icon:e,offset:"100%",repeat:"10px"}],zIndex:d}),google.maps.event.addListener(activeTrObj,"click",function(){viewTrDetails(a)}),activeTrObj.setMap(map)},newIpFlag=function(){jQuery("#ip-flags-data").hide()},saveIpFlag=function(){console.log("saving ip flag");for(var a="",b=1;b<7;b++){var c=jQuery("#ip-t-"+b).is(":checked");c&&(a+=jQuery("#ip-t-"+b).val()+",")}var d={action:"saveIpFlag",ip_addr_f:activeIpFlag,user_ip:myIp,user_nick:getPar("user_nick"),user_reasons_types:a,user_msg:getPar("user_msg"),ip_new_loc:getPar("ip_new_loc")};jQuery.ajax(url_base+"/application/controller/ipFlag.php",{type:"post",data:d,success:function(a){console.log("Ok! saveIpFlag"),jQuery(".flagging.modal").modal("hide"),jQuery.toast({heading:"Thank you for flagging this router",text:"We will review your suggestion and update our database accordingly. In the meantime, you can view traceroutes with flagged routers removed (these and other options are available through the Gear icon on the map)",hideAfter:1e4,allowToastClose:!0,position:"mid-center",icon:"success"}),1==a&&getIpFlags(!0)},error:function(a){console.log("Error! saveIpFlag",a)}})},getPar=function(a){var b=jQuery("#"+a).val();return b},getIpFlags=function(a){console.log("getting ip flags data");var b={action:"getIpFlag",ip_addr_f:activeIpFlag};jQuery.ajax(url_base+"/application/controller/ipFlag.php",{type:"post",data:b,success:function(b){console.log("Ok! getIpFlag");var c=jQuery.parseJSON(b);a?(jQuery("#ip-flags").show(),jQuery("#user_nick").val(""),jQuery("#ip_new_loc").val(""),jQuery("#user_msg").val(""),c.ip_flags?jQuery("#ip-flags-data").fadeIn("fast"):(jQuery("#ip-flags-data-list").html(""),jQuery("#ip-flags-data").hide()),renderIpFlagData(c)):renderIpFlagDataMouseOver(c)},error:function(a){console.log("Error! getIpFlag",a)}})},renderIpFlagDataMouseOver=function(a){console.log("renderIpFlagDataMouseOver")},renderIpFlagData=function(a){console.log("OK! renderIpFlagData");var b=a.ip_addr_info[0],c=b.mm_lat,d=b.mm_long,e=b.name,f="Unknown";b.mm_lat!==b.lat&&(c=b.lat),b.mm_long!==b.long&&(d=b.long),e.length>36&&(e=e.slice(0,36)+"..."),f=1==b.gl_override||2==b.gl_override?"Geolocation determined by hostname parsing methods":3==b.gl_override?"Geolocation determined by pre/post hop patterns and latency analysis":b.gl_override?"Geolocation determined by IXmaps internal methods":a.ip_flags?"Geolocation has been flagged as potentially inaccurate":"Geolocation determined by Maxmind",jQuery("#ip-flag-tr-id").text(activeTridFlag),jQuery("#ip-flag-router").text(activeHopNumFlag),jQuery("#ip-flag-ip-address").text(b.ip_addr),jQuery("#ip-flag-asn-name").text(e),jQuery("#ip-flag-hostname").text(b.hostname),jQuery("#ip-flag-star-rating").html(renderPrivacyScore(getPrivacyScore(b.num))),jQuery("#ip-flag-location").text(getCityRegionCountry(b.mm_city,b.mm_region,b.mm_country)),jQuery("#ip-flag-lat-long").text(c+", "+d),jQuery("#ip-flag-gl-override").text(f);var g="";a.ip_flags&&(g+='<table id="ip-flags-table" style="width: 100%;" class="tablesorter tr-list-result"><thead><tr><th>User</th><th>Date</th><th>Suggested Location</th><th>Comment</th></thead><tbody>',jQuery.each(a.ip_flags,function(a,b){g+="<tr><td>"+b.user_nick+"</td><td>"+b.date_f.slice(0,10)+"</td><td>"+b.ip_new_loc+"</td><td>"+b.user_msg+"</td></tr>"}),g+="</tbody></table>"),jQuery("#ip-flags-data-list").html(g),jQuery("#ip-flags-table").tablesorter({headers:{0:{sorter:!1},1:{sorter:!1},2:{sorter:!1},3:{sorter:!1}}})},activeIpFlag="",activeHopNumFlag="",activeTridFlag="",flagCounter=0,showFlags=function(a,b,c,d){activeIpFlag=c,activeTridFlag=a,activeHopNumFlag=b,console.log("ip: "+c+", trId: "+a+", hopH: "+b),console.log("Displaying Flag info for ip: "+activeIpFlag),d||jQuery("#flagging-info-m").html("Getting Flags..."),getIpFlags(d)},trHopMouseover=function(a,b,c){var d="",e="",f="";if(0==c)e="Router",d="<br/>IP: <strong>"+ixMapsDataJson[a][b].ip+"</strong>",d+=' | <span id="flag-this-link"></span>';else{e="Hop";var g=parseInt(b);g++,f="-"+g}var h=""+e+": <strong>"+b+f+"</strong><br/>Carrier: <strong>"+ixMapsDataJson[a][b].asName+"</strong>, ASN: <strong>"+ixMapsDataJson[a][b].asNum+"</strong>"+d;h+='<div id="flagging-info-m"></div>',jQuery("#map-info").html(h),activeTrId=a},removeAllButThis=function(a){removeTr(),removeAllTrs(),showThisTr(a)},viewPrivacy=function(a){var b="",c="",d=0;jQuery("#carrier-title").html("<h5>"+privacyData.scores[a][0].carrier_name+" (ASN: "+privacyData.scores[a][0].asn+")</h5>"),b+='<table id="privacy-details-table">',b+="<tr><td> </td><td><b>Criteria</b></td><td><b>Score</b></td></tr>",jQuery("#privacy-details").fadeIn("slow"),jQuery.each(privacyData.scores[a],function(a,e){var f=parseFloat(e.score);d+=f;var g=""+e.score;f>0&&(g='<span class="privacy-score-col-non-zero">'+e.score+"</span>"),c="<b>"+privacyData.stars[e.star_id].star_short_name+"</b> ",c+=""+privacyData.stars[e.star_id].star_long_des,b+="<tr><td>"+e.star_id+"</td><td>"+c+'</td><td class="privacy-score-col">'+g+"</td></tr>"}),b+="<tr><td></td>",b+="<td>",b+='<div id="privacy-feedback-info"><a class="link" target="_new" href="'+privacyRepUrl+'">View the full transpacency report</a></div>',b+='<div id="privacy-total-label"><b>Total Score </b></div>',b+="</td>",b+='<td class="privacy-score-col"><span class="privacy-score-col-total">'+d+"</span></td>",b+="</tr>",b+="</table>",jQuery("#privacy-details-data").html(b),setTimeout(function(){jQuery(".carrier.modal").modal("show")},200)},viewTrDetails=function(a){jQuery("#tr-details-modal .traceroute-container tbody").empty(),aHop=ixMapsDataJson[a][Object.keys(ixMapsDataJson[a])[0]],d=new Date(aHop.subTime),submitterDateTime=d.toLocaleDateString()+" "+d.toLocaleTimeString(),jQuery("#tr-details-modal .tr-metadata-container .tr-id").text(a),jQuery("#tr-details-modal .tr-metadata-container .submitter").text(aHop.submitter),jQuery("#tr-details-modal .tr-metadata-container .sub-time").text(submitterDateTime),jQuery("#tr-details-modal .tr-metadata-container .zip-code").text(aHop.zipCode),jQuery("#tr-details-modal .tr-metadata-container .destination").text(aHop.destHostname),jQuery("#tr-details-modal").modal("show"),jQuery.each(ixMapsDataJson[a],function(a,b){var c=jQuery("<td />").text(b.mmCity);null!=b.mmCountry&&(c=jQuery(c).prepend(jQuery("<i />").addClass("flag "+b.mmCountry.toLowerCase())));var d=b.asName;null!=b.asShortName&&(d=b.asShortname),jQuery("#tr-details-modal .traceroute-container tbody").append(jQuery("<tr />").append(jQuery("<td />").text(a),jQuery(c),jQuery("<td />").css("background",getAsnBackground(b.asNum)).text(d))),jQuery("#tr-details-modal .traceroute-container-more-details tbody").append(jQuery("<tr />").append(jQuery("<td />").text(b.hopN),jQuery("<td />").text(b.ip),jQuery("<td />").text(b.hostname),jQuery("<td />").text(b.asNum),jQuery("<td />").text(b.lat),jQuery("<td />").text(b.long),jQuery("<td />").text(b.glOverride)))})},getCityRegionCountry=function(a,b,c){var d="",e=[],f=!0;return a&&a.length>0&&e.push(a),b&&b.length>0&&e.push(b),c&&c.length>0&&e.push(c),e.forEach(function(a){f?(d+=a,f=!1):d+=", "+a}),d},toggleMap=function(){jQuery("#map-container").toggle(),jQuery("#map-canvas-container").toggle(),jQuery("#tr-list-ids").toggle()},renderGeoMarkers=function(a){jQuery.each(cHotelData,function(b,c){var d;1==a&&"NSA"==c.type&&(d=createGmMarker(c),gmNsa.push(d),d.setMap(map)),2==a&&"CH"==c.type&&(d=createGmMarker(c),gmHotel.push(d),d.setMap(map)),3==a&&"Google"==c.type&&(d=createGmMarker(c),gmGoogle.push(d),d.setMap(map)),4==a&&"UC"==c.type&&(d=createGmMarker(c),gmUc.push(d),d.setMap(map)),5==a&&"IXca"==c.type&&(d=createGmMarker(c),gmIXca.push(d),d.setMap(map)),6==a&&"CIRA_IPT"==c.type&&(d=createGmMarker(c),gmCiraIPT.push(d),d.setMap(map)),7==a&&"AT&T"==c.type&&(d=createGmMarker(c),gmAtt.push(d),d.setMap(map)),8==a&&"Verizon"==c.type&&(d=createGmMarker(c),gmVerizon.push(d),d.setMap(map)),9==a&&"GoogleTo"==c.type&&(d=createGmMarker(c),gmGoogleTO.push(d),d.setMap(map))})},removeGeoMarkers=function(a){if(1==a)for(;gmNsa[0];)gmNsa.pop().setMap(null);else if(2==a)for(;gmHotel[0];)gmHotel.pop().setMap(null);else if(3==a)for(;gmGoogle[0];)gmGoogle.pop().setMap(null);else if(4==a)for(;gmUc[0];)gmUc.pop().setMap(null);else if(5==a)for(;gmIXca[0];)gmIXca.pop().setMap(null);else if(6==a)for(;gmCiraIPT[0];)gmCiraIPT.pop().setMap(null);else if(7==a)for(;gmAtt[0];)gmAtt.pop().setMap(null);else if(8==a)for(;gmVerizon[0];)gmVerizon.pop().setMap(null);else if(9==a)for(;gmGoogleTO[0];)gmGoogleTO.pop().setMap(null)},createGmMarker=function(a){var b=new google.maps.LatLng(a.lat,a.long),c=new google.maps.Marker({position:b,map:map}),d="";"NSA"==a.type&&"A"==a.nsa?d=url_base+"/_assets/img/icn-map-nsa-class-A.png":"NSA"==a.type&&"A"!=a.nsa?d=url_base+"/_assets/img/icn-map-nsa-class-med.png":"CH"==a.type?d=url_base+"/_assets/img/icn-map-carrier.png":"UC"==a.type?d=url_base+"/_assets/img/icn-map-undersea.png":"Google"==a.type||"GoogleTo"==a.type?d=url_base+"/_assets/img/icn-map-google.png":"IXca"==a.type?d=url_base+"/_assets/img/icn-map-ixp.png":"CIRA_IPT"==a.type?d=url_base+"/_assets/img/icn-map-ipt.png":"AT&T"==a.type?d=url_base+"/_assets/img/icn-map-att.png":"Verizon"==a.type&&(d=url_base+"/_assets/img/icn-map-verizon.png"),c.setIcon(d);var e='<span class="geoitem-layer-name">'+a.layer_name+"</span>";e+="<br/><b>"+a.address+"</b>",""!=a.image&&(e+='<br/><img src="'+a.image+'" width="100px"/></a>'),""!=a.ch_operator&&(e+="<br/>Operator: <b>"+a.ch_operator+"</b>"),""!=a.ch_build_owner?e+="<br/>Building Owner: <b>"+a.ch_build_owner+"</b>":""!=a.ch_build_owner&&""!=a.ch_build_owner_src&&(e+='<br/>Building Owner: <a href="'+a.ch_build_owner+'"></a>'),""!=a.isp_src&&(e+='<br/><a href="'+a.isp_src+'" target="_blank">ISP</a>'),""!=a.nsa_src&&(e+='<br/><a href="'+a.nsa_src+'" target="_blank">NSA Source</a>');var f=new google.maps.InfoWindow({content:e});return google.maps.event.addListener(c,"click",function(){f.open(map,c)}),c},getPrivacyReport=function(){console.log("Loading PrivacyReport data");var a={action:"getPrivacyReport"};jQuery.ajax(url_base+"/application/controller/privacyReport.php",{type:"post",data:a,success:function(a){console.log("Ok! getPrivacyReport"),privacyData=jQuery.parseJSON(a)},error:function(a){console.log("Error! getPrivacyReport",a)}})},getPrivacyScore=function(a){var b=0;return privacyData.scores[a]&&jQuery.each(privacyData.scores[a],function(a,c){var d=parseFloat(c.score);b+=d}),b},renderPrivacyScore=function(a){var b=0,c=0,d=parseFloat(a);b=parseInt(a),c=a-b;var e="";if(b>=1)for(var f=0;f<b;f++)e+='<img src="'+url_base+'/_assets/img/star-a-4.png" class="privacy-star-img">';return 0==d&&(e+='<img src="'+url_base+'/_assets/img/star-a-0.png" class="privacy-star-img">'),c>0&&c<=.5&&(e+='<img src="'+url_base+'/_assets/img/star-a-2.png" class="privacy-star-img">'),e},asnColours='{"174":"rgb(228,49,235)","3356":"rgb(235,114,49)","7018":"rgb(66,237,234)","7132":"rgb(66,237,234)","-1":"rgb(103,106,107)","577":"rgb(61,73,235)","1239":"rgb(236,242,68)","6461":"rgb(227,174,235)","6327":"rgb(156,104,70)","6453":"rgb(103,106,107)","3561":"rgb(103,106,107)","812":"rgb(237,9,36)","20453":"rgb(237,9,36)","852":"rgb(75,230,37)","13768":"rgb(65,156,107)","3257":"rgb(103,106,107)","1299":"rgb(103,106,107)","22822":"rgb(103,106,107)","6939":"rgb(103,106,107)","376":"rgb(103,106,107)","32613":"rgb(103,106,107)","6539":"rgb(61,73,235)","15290":"rgb(103,106,107)","5769":"rgb(103,106,107)","855":"rgb(103,106,107)","26677":"rgb(103,106,107)","271":"rgb(103,106,107)","6509":"rgb(103,106,107)","3320":"rgb(103,106,107)","23498":"rgb(103,106,107)","549":"rgb(103,106,107)","239":"rgb(103,106,107)","11260":"rgb(103,106,107)","1257":"rgb(103,106,107)","20940":"rgb(103,106,107)","23136":"rgb(103,106,107)","5645":"rgb(103,106,107)","21949":"rgb(103,106,107)","8111":"rgb(103,106,107)","13826":"rgb(103,106,107)","16580":"rgb(103,106,107)","9498":"rgb(103,106,107)","802":"rgb(103,106,107)","19752":"rgb(103,106,107)","11854":"rgb(103,106,107)","7992":"rgb(103,106,107)","17001":"rgb(103,106,107)","611":"rgb(103,106,107)","19080":"rgb(103,106,107)","26788":"rgb(103,106,107)","12021":"rgb(103,106,107)","33554":"rgb(103,106,107)","30528":"rgb(103,106,107)","16462":"rgb(103,106,107)","11700":"rgb(103,106,107)","14472":"rgb(103,106,107)","13601":"rgb(103,106,107)","11032":"rgb(103,106,107)","12093":"rgb(103,106,107)","10533":"rgb(103,106,107)","26071":"rgb(103,106,107)","32156":"rgb(103,106,107)","5764":"rgb(103,106,107)","27168":"rgb(103,106,107)","33361":"rgb(103,106,107)","32489":"rgb(103,106,107)","15296":"rgb(103,106,107)","10400":"rgb(103,106,107)","10965":"rgb(103,106,107)","18650":"rgb(103,106,107)","36522":"rgb(103,106,107)","19086":"rgb(103,106,107)"}',asnColoursJson=jQuery.parseJSON(asnColours),getAsnColour=function(a){
var b="rgb(153, 153, 153)";return"undefined"!=typeof asnColoursJson[a]&&(b=asnColoursJson[a]),b},getAsnBackground=function(a){return c=getAsnColour(a),c=c.replace("rgb","rgba"),c=c.replace(")",", 0.8)"),c};